<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading Dashboard...</title>
    <script>
        // Immediate redirect to ensure libraries load in correct order
        // This is a temporary fix that loads libraries early
        
        // Create a loader page that ensures libraries are loaded before dashboard initializes
        document.write(`
            <style>
                body {
                    background: #0f172a;
                    color: #f1f5f9;
                    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    height: 100vh;
                    margin: 0;
                }
                .loader {
                    text-align: center;
                }
                .spinner {
                    border: 3px solid rgba(255,255,255,0.1);
                    border-top: 3px solid #3b82f6;
                    border-radius: 50%;
                    width: 50px;
                    height: 50px;
                    animation: spin 1s linear infinite;
                    margin: 0 auto 20px;
                }
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            </style>
            <div class="loader">
                <div class="spinner"></div>
                <h2>Loading Dashboard Libraries...</h2>
                <p>Please wait while we initialize the application</p>
            </div>
        `);
        
        // Load libraries in correct order
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }
        
        // Load libraries sequentially
        async function loadLibraries() {
            try {
                console.log('Loading Cytoscape...');
                await loadScript('./js/cytoscape.min.js');
                
                console.log('Loading Cytoscape COSE Bilkent...');
                await loadScript('./js/cytoscape-cose-bilkent.js');
                
                console.log('Loading Popper...');
                await loadScript('./js/popper.min.js');
                
                console.log('Loading Tippy...');
                await loadScript('./js/tippy.min.js');
                
                console.log('Loading Graph Advanced...');
                await loadScript('/static/graph-advanced.js');
                
                console.log('All libraries loaded! Redirecting to dashboard...');
                
                // Store library loaded state
                sessionStorage.setItem('librariesLoaded', 'true');
                
                // Redirect to actual dashboard
                window.location.href = '/?libraries=loaded';
                
            } catch (error) {
                console.error('Failed to load libraries:', error);
                document.querySelector('.loader').innerHTML = `
                    <h2>Error Loading Libraries</h2>
                    <p>Failed to load required libraries. Please refresh the page.</p>
                    <button onclick="location.reload()" style="padding: 10px 20px; margin-top: 20px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer;">Refresh</button>
                `;
            }
        }
        
        // Start loading immediately
        window.addEventListener('DOMContentLoaded', loadLibraries);
    </script>
</head>
<body>
</body>
</html>